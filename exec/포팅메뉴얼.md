# Porting Manual   
<br/>

## Environment

**FrontEnd**  

- npm: `18.18.2`
- pnpm: `8.9.2`
- Nexy.js: `13.5.4`
- TypeScript: `5.2.2`
- React-Query: `4.36.1`
- Zustand: `4.4.3`
- Tailwind CSS: `3.3.3`


**DevOps**  

- Docker: `24.0.7`
- Nginx: `nginx/1.18.0`  


**Server**  

- AWS EC2: `ubuntu 20.04.6 LTS`
- IntelliJ: `IDEA 2023.1`
- SpringBoot: `3.1.4`
- JDK: `openjdk 17`

- python: `>=3.8.x`
- flask: `3.0.0`
- flask-cors: `4.0.0`
- Pillow: `10.0.1`
- PyMatting: `1.1.11`
- rembg: `2.0.52`
- scipy: `1.11.3`


**Database**  

- MySQL: `8.0.34-0ubuntu0.20.04.1`  
- Redis: `5.0.7`
- S3


**Collaboration**  

- GitLab
- Jira
- Notion  

<br/>


<!-- ## DB Setting

1. Create MySql account.

2. Run the S09P31A309/exec/resource/VODA_DB_Dump20230817.sql file in the workbench.

<br/> -->

## Build

### Front-End(Nextjs)

1. 경로 이동(프로젝트 루트 기준)  
`cd front/`  

2. 해당 경로에 env 파일 추가
`touch .env.local`

3. (최초 1회) pnpm 설치
`npm i -g pnpm` 혹은 `npm install -g pnpm`  

4. pnpm 패키지 설치
`pnpm i` 혹은 `pnpm install`  


5. 빌드하기
`pnpm build` 혹은 `pnpm run build`  


### Back-End(Java Springboot)

1. 경로 이동(프로젝트 루트 기준)  
`cd back/groogroo/`  

2. 


### Back-End(Flask)

* 다음 링크 참고: **[flask 실행하기](../flask/readme.md)**



## Deploy

### Nginx 설정
```
upstream frontend {
    server 0.0.0.0:3000;
}

upstream backend {
    server 0.0.0.0:8888;
}

upstream flask {
    server 0.0.0.0:5000;
}

server {
    listen 443 ssl http2;
    server_name groogroo.site www.groogroo.site;
    charset     utf-8;

    ssl_certificate        /etc/ssl/groogroo/nginx_ssl.crt;
    ssl_certificate_key    /etc/ssl/groogroo/private.key;

    location /api {
        proxy_pass http://backend;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_http_version 1.1;
        proxy_redirect off;
        proxy_set_header X-NginX-Proxy true;

        proxy_connect_timeout 600;
        proxy_read_timeout 600;
        proxy_send_timeout 600;
        proxy_buffers 4 256k;
        proxy_buffer_size 128k;
    }

    location /flask {
        proxy_pass http://flask;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;

        proxy_read_timeout 600;
        proxy_send_timeout 600;
        proxy_buffers 4 256k;
        proxy_buffer_size 128k;
    }

    location / {
        add_header Access-Control-Allow-Origin *;
        proxy_pass http://frontend;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;

        proxy_read_timeout 600;
        proxy_send_timeout 600;
        proxy_buffers 4 256k;
        proxy_buffer_size 128k;
    }
}

server {
    listen 80;
    server_name groogroo.site k9a309.p.ssafy.io;

   location / {
       return 301 https://groogroo.site$request_uri;
   }
}
```

### 젠킨스 파이프라인 구성

#### front

#### back

#### flask